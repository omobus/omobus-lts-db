<?xml version="1.0" encoding="utf-8"?>
<omobusd timeout="90">
    <storage module="stor_pgsql" MSSQLmodule="stor_tds" server="hostaddr=127.0.0.1 port=5432" MSSQLserver="srv1" storage="omobus-lts-db" user="omobus" password="omobus" trace="no"/>
    <transaction level="write" onsuccess="commit" onerror="rollback"/>
    <kernel module="kern_import" ldap.uri="ldap://127.0.0.1:389" ldap.bind_dn="uid=omobusd,ou=services,dc=omobus,dc=local" ldap.bind_pw="0" ldap.base="ou=lts-db,dc=omobus,dc=local" ldap.filter="(&amp;(objectClass=omobusMaintainPoint)(exchangeStatus=enabled))" Xldap.tls="yes" ftp.host="zdev.omobus.net" ftp.port="21021" ftp.path="data/" ftp.connect_timeout="20" ftp.recv_timeout="10" ftp.send_timeout="10" ftp.epsv="yes" ftp.tls="yes" ftp.ccc="no" ftp.cdc="no" pack.gc="1" cache="LTS/data/">
<!--<xi:include href="../queries/data/trig_before.xconf" xmlns:xi="http://www.w3.org/2003/XInclude" />-->
<trig_blob>
  <![CDATA[ 
--select stor_blob_stream('//proxy/%uid%/%pack_name%', $1:blob, '%server_hostname%')
exec stor_blob_stream '//proxy/%uid%/%pack_name%', '$1:blob', '%server_hostname%'
  ]]>
</trig_blob>
<_timestamp templ="%timestamp%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from sysparams
    where param_id = '%ErpCode%:TS'
  ]]>
</check_exist>
<update>
  <![CDATA[
update sysparams set param_value='%timestamp%'
    where param_id = '%ErpCode%:TS'
  ]]>
</update>
<insert>
  <![CDATA[
insert into sysparams (param_id, param_value) 
    values ('%ErpCode%:TS', '%timestamp%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</_timestamp>

<accounts templ="%account_id%;%pid%;%code%;%ftype%;%descr%;%address%;%region_id%;%city_id%;%rc_id%;%chan_id%;%poten_id%;%cash_register%;%latitude%;%longitude%;%attr_ids%;%locked%;%approved%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update accounts set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from accounts 
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update accounts set pid=dbo.uid_in('%pid%'), code='%code%', ftype=0%ftype%, descr='%descr%', address='%address%', region_id=dbo.uid_in('%region_id%'), city_id=dbo.uid_in('%city_id%'), rc_id=dbo.uid_in('%rc_id%'), chan_id=dbo.uid_in('%chan_id%'), poten_id=dbo.uid_in('%poten_id%'), cash_register=dbo.int32_in('%cash_register%'), latitude=dbo.gps_in('%latitude%'), longitude=dbo.gps_in('%longitude%'), attr_ids=dbo.uids_in('%attr_ids%'), locked=0%locked%, approved=0%approved%, hidden=0
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into accounts(db_id, pid, account_id, code, ftype, descr, address, region_id, city_id, rc_id, chan_id, poten_id, cash_register, latitude, longitude, attr_ids, locked, approved, hidden)
    values('%ErpCode%', dbo.uid_in('%pid%'), '%account_id%', '%code%', 0%ftype%, '%descr%', '%address%', dbo.uid_in('%region_id%'), dbo.uid_in('%city_id%'), dbo.uid_in('%rc_id%'), dbo.uid_in('%chan_id%'), dbo.uid_in('%poten_id%'), dbo.int32_in('%cash_register%'), dbo.gps_in('%latitude%'), dbo.gps_in('%longitude%'), dbo.uids_in('%attr_ids%'), 0%locked%, 0%approved%, 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</accounts>
<activity_types templ="%activity_type_id%;%descr%;%strict%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update activity_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from activity_types 
    where db_id = '%ErpCode%' and activity_type_id = '%activity_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update activity_types set descr='%descr%', strict=0%strict%, hidden=0
    where db_id = '%ErpCode%' and activity_type_id = '%activity_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into activity_types (db_id, activity_type_id, descr, strict, hidden) 
    values ('%ErpCode%', '%activity_type_id%', '%descr%', 0%strict%, 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</activity_types>
<additions templ="%doc_id%;%fix_dt%;%user_id%;%account%;%address%;%legal_address%;%number%;%addition_type_id%;%note%;%chan_id%;%attr_ids%;%photos%;%account_id%;%validator_id%;%validated%;%hidden%;%geo_address%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from additions 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update additions set user_id='%user_id%', fix_dt='%fix_dt%', account='%account%', address='%address%', legal_address='%legal_address%', number='%number%', addition_type_id='%addition_type_id%', note='%note%', chan_id='%chan_id%', attr_ids=dbo.uids_in('%attr_ids%'), photos=dbo.uids_in('%photos%'), account_id='%account_id%', validator_id=dbo.uid_in('%validator_id%'), validated=0%validated%, hidden=0%hidden%, geo_address='%geo_address%'
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into additions (db_id, doc_id, user_id, fix_dt, account, address, legal_address, number, addition_type_id, note, chan_id, attr_ids, photos, account_id, validator_id, validated, hidden, geo_address) 
    values ('%ErpCode%', '%doc_id%', '%user_id%', '%fix_dt%', '%account%', '%address%', '%legal_address%', '%number%', '%addition_type_id%', '%note%', '%chan_id%', dbo.uids_in('%attr_ids%'), dbo.uids_in('%photos%'), '%account_id%', dbo.uid_in('%validator_id%'), 0%validated%, 0%hidden%, '%geo_address%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</additions>
<addition_types templ="%addition_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update addition_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from addition_types 
    where db_id = '%ErpCode%' and addition_type_id = '%addition_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update addition_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and addition_type_id = '%addition_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into addition_types (db_id, addition_type_id, descr, hidden) 
    values ('%ErpCode%', '%addition_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</addition_types>
<agencies templ="%agency_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update agencies set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from agencies 
    where db_id = '%ErpCode%' and agency_id = '%agency_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update agencies set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and agency_id = '%agency_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into agencies (db_id, agency_id, descr, hidden) 
    values ('%ErpCode%', '%agency_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</agencies>
<agreements templ="%account_id%;%placement_id%;%posm_id%;%b_date%;%e_date%;%strict%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from agreements
    where db_id = '%ErpCode%' and 
e_date >= current_date::date_t
--e_date >= convert(varchar(10), getdate(), 121)
  ]]>
</begin>
<insert>
  <![CDATA[
insert into agreements (db_id, account_id, placement_id, posm_id, b_date, e_date, "strict")
    values ('%ErpCode%', '%account_id%', '%placement_id%', '%posm_id%', '%b_date%', '%e_date%', 0%strict%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</agreements>
<attributes templ="%attr_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update attributes set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from attributes
    where db_id = '%ErpCode%' and attr_id = '%attr_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update attributes set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and attr_id = '%attr_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into attributes (db_id, attr_id, descr)
    values ('%ErpCode%', '%attr_id%', '%descr%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</attributes>
<audit_criterias templ="%audit_criteria_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update audit_criterias set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from audit_criterias 
    where db_id = '%ErpCode%' and audit_criteria_id = '%audit_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update audit_criterias set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and audit_criteria_id = '%audit_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into audit_criterias (db_id, audit_criteria_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%audit_criteria_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</audit_criterias>
<audit_scores templ="%audit_score_id%;%descr%;%score%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update audit_scores set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from audit_scores 
    where db_id = '%ErpCode%' and audit_score_id = '%audit_score_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update audit_scores set descr='%descr%', score=%score%, row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and audit_score_id = '%audit_score_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into audit_scores (db_id, audit_score_id, descr, score, row_no, hidden) 
    values ('%ErpCode%', '%audit_score_id%', '%descr%', %score%, dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</audit_scores>
<brands templ="%brand_id%;%descr%;%manuf_id%;%dep_id%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update brands set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from brands 
    where db_id = '%ErpCode%' and brand_id = '%brand_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update brands set descr='%descr%', manuf_id='%manuf_id%', dep_id=dbo.uid_in('%dep_id%'), row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and brand_id = '%brand_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into brands (db_id, brand_id, descr, manuf_id, dep_id, row_no, hidden) 
    values ('%ErpCode%', '%brand_id%', '%descr%', '%manuf_id%', dbo.uid_in('%dep_id%'), dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</brands>
<canceling_types templ="%canceling_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update canceling_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from canceling_types 
    where db_id = '%ErpCode%' and canceling_type_id = '%canceling_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update canceling_types set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and canceling_type_id = '%canceling_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into canceling_types (db_id, canceling_type_id, descr, hidden) 
    values ('%ErpCode%', '%canceling_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</canceling_types>
<cancellations templ="%user_id%;%route_date%;%canceling_type_id%;%note%;%hidden%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from cancellations 
    where db_id = '%ErpCode%' and user_id = '%user_id%' and route_date = '%route_date%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update cancellations set canceling_type_id='%canceling_type_id%', note='%note%', hidden=0%hidden%
    where db_id = '%ErpCode%' and user_id = '%user_id%' and route_date = '%route_date%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into cancellations (db_id, user_id, route_date, canceling_type_id, note, hidden) 
    values ('%ErpCode%', '%user_id%', '%route_date%', '%canceling_type_id%', '%note%', 0%hidden%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</cancellations>
<categories templ="%categ_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update categories set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from categories 
    where db_id = '%ErpCode%' and categ_id = '%categ_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update categories set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and categ_id = '%categ_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into categories (db_id, categ_id, descr, row_no, hidden)
    values ('%ErpCode%', '%categ_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</categories>
<channels templ="%chan_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update channels set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from channels 
    where db_id = '%ErpCode%' and chan_id = '%chan_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update channels set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and chan_id = '%chan_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into channels (db_id, chan_id, descr, hidden)
    values ('%ErpCode%', '%chan_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</channels>
<cities templ="%city_id%;%pid%;%ftype%;%descr%;%country_id%;%population%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update cities set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from cities 
    where db_id = '%ErpCode%' and city_id = '%city_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update cities set pid='%pid%', ftype=0%ftype%, descr='%descr%', country_id='%country_id%', population=dbo.int32_in('%population%'), hidden=0
    where db_id = '%ErpCode%' and city_id = '%city_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into cities (db_id, pid, city_id, ftype, descr, country_id, population, hidden) 
    values ('%ErpCode%', '%pid%', '%city_id%', 0%ftype%, '%descr%', '%country_id%', dbo.int32_in('%population%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</cities>
<comments templ="%doc_id%;%fix_dt%;%user_id%;%account_id%;%comment_type_id%;%doc_note%;%photo%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from comments 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into comments (db_id, doc_id, fix_dt, user_id, account_id, comment_type_id, doc_note, photo) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%comment_type_id%', '%doc_note%', dbo.uid_in('%photo%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</comments>
<comment_types templ="%comment_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update comment_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from comment_types 
    where db_id = '%ErpCode%' and comment_type_id = '%comment_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update comment_types set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and comment_type_id = '%comment_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into comment_types (db_id, comment_type_id, descr, hidden) 
    values ('%ErpCode%', '%comment_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</comment_types>
<!--<xi:include href="../queries/data/conferences.xconf" xmlns:xi="http://www.w3.org/2003/XInclude" />-->
<confirmation_types templ="%confirm_id%;%descr%;%target_type_ids%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update confirmation_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from confirmation_types 
    where db_id = '%ErpCode%' and confirm_id = '%confirm_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update confirmation_types set descr='%descr%', target_type_ids=dbo.uids_in('%target_type_ids%'), hidden=0
    where db_id = '%ErpCode%' and confirm_id = '%confirm_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into confirmation_types (db_id, confirm_id, descr, target_type_ids, hidden) 
    values ('%ErpCode%', '%confirm_id%', '%descr%', dbo.uids_in('%target_type_ids%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</confirmation_types>
<confirmations templ="%doc_id%;%fix_dt%;%user_id%;%account_id%;%target_id%;%confirm_id%;%doc_note%;%photo0%;%photo1%;%photo2%;%photo3%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from confirmations 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into confirmations (db_id, doc_id, fix_dt, user_id, account_id, target_id, confirm_id, doc_note, photos) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%target_id%', '%confirm_id%', '%doc_note%', dbo.uids_in('%photos%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</confirmations>
<contacts templ="%contact_id%;%account_id%;%name%;%surname%;%patronymic%;%job_title_id%;%phone%;%mobile%;%email%;%locked%;%extra_info%;%author_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update contacts set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from contacts 
    where db_id = '%ErpCode%' and contact_id = '%contact_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update contacts set account_id='%account_id%', name='%name%', surname='%surname%', patronymic='%patronymic%', job_title_id='%job_title_id%', phone='%phone%', mobile='%mobile%', email='%email%', locked=0%locked%, extra_info='%extra_info%', author_id='%author_id%', hidden=0
    where db_id = '%ErpCode%' and contact_id = '%contact_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into contacts (db_id, contact_id, account_id, name, surname, patronymic, job_title_id, phone, mobile, email, locked, extra_info, author_id, hidden) 
    values ('%ErpCode%', '%contact_id%', '%account_id%', '%name%', '%surname%', '%patronymic%', '%job_title_id%', '%phone%', '%mobile%', '%email%', 0%locked%, '%extra_info%', '%author_id%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</contacts>
<countries templ="%country_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update countries set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from countries 
    where db_id = '%ErpCode%' and country_id = '%country_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update countries set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and country_id = '%country_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into countries (db_id, country_id, descr, hidden) 
    values ('%ErpCode%', '%country_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</countries>
<deletions templ="%account_id%;%user_id%;%fix_dt%;%note%;%photo%;%validator_id%;%validated%;%hidden%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from deletions 
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update deletions set user_id='%user_id%', fix_dt='%fix_dt%', note='%note%', photo=dbo.uid_in('%photo%'), validator_id=dbo.uid_in('%validator_id%'), validated=0%validated%, hidden=0%hidden%
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into deletions (db_id, account_id, user_id, fix_dt, note, photo, validator_id, validated, hidden) 
    values ('%ErpCode%', '%account_id%', '%user_id%', '%fix_dt%', '%note%', dbo.uid_in('%photo%'), dbo.uid_in('%validator_id%'), 0%validated%, 0%hidden%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</deletions>
<delivery_types templ="%delivery_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update delivery_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from delivery_types 
    where db_id = '%ErpCode%' and delivery_type_id = '%delivery_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update delivery_types set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and delivery_type_id = '%delivery_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into delivery_types (db_id, delivery_type_id, descr, hidden) 
    values ('%ErpCode%', '%delivery_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</delivery_types>
<departments templ="%dep_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update departments set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from departments 
    where db_id = '%ErpCode%' and dep_id = '%dep_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update departments set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and dep_id = '%dep_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into departments (db_id, dep_id, descr, hidden) 
    values ('%ErpCode%', '%dep_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</departments>
<discard_types templ="%discard_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update discard_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from discard_types 
    where db_id = '%ErpCode%' and discard_type_id = '%discard_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update discard_types set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and discard_type_id = '%discard_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into discard_types (db_id, discard_type_id, descr, hidden) 
    values ('%ErpCode%', '%discard_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</discard_types>
<discards templ="%account_id%;%user_id%;%fix_dt%;%activity_type_id%;%route_date%;%discard_type_id%;%note%;%validator_id%;%validated%;%hidden%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from discards 
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update discards set user_id='%user_id%', fix_dt='%fix_dt%', activity_type_id='%activity_type_id%', route_date='%route_date%', discard_type_id='%discard_type_id%', note='%note%', validator_id='%validator_id%', validated=0%validated%, hidden=0%hidden%
    where db_id = '%ErpCode%' and account_id = '%account_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into discards (db_id, account_id, user_id, fix_dt, activity_type_id, route_date, discard_type_id, note, validator_id, validated, hidden) 
    values ('%ErpCode%', '%account_id%', '%user_id%', '%fix_dt%', '%activity_type_id%', '%route_date%', '%discard_type_id%', '%note%', '%validator_id%', 0%validated%, 0%hidden%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</discards>
<distributors templ="%distr_id%;%pid%;%descr%;%country_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update distributors set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from distributors 
    where db_id = '%ErpCode%' and distr_id = '%distr_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update distributors set descr='%descr%', pid='%pid%', country_id='%country_id%', hidden=0
    where db_id = '%ErpCode%' and distr_id = '%distr_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into distributors (db_id, distr_id, descr, pid, country_id, hidden) 
    values ('%ErpCode%', '%distr_id%', '%descr%', '%pid%', '%country_id%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
update distributors set pid=null where pid='' and hidden=0;
update distributors set country_id=null where country_id='' and hidden=0;
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</distributors>
<dyn_advt templ="%fix_date%;%account_id%;%placement_id%;%posm_id%;%qty%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_advt 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and placement_id = '%placement_id%' and posm_id = '%posm_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_advt set qty=0%qty%, user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and placement_id = '%placement_id%' and posm_id = '%posm_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_advt (db_id, fix_date, account_id, placement_id, posm_id, qty, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%placement_id%', '%posm_id%', 0%qty%, '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_advt>
<dyn_audits templ="%fix_date%;%account_id%;%categ_id%;%audit_criteria_id%;%audit_score_id%;%criteria_wf%;%score_wf%;%score%;%note%;%wf%;%sla%;%photos%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_audits 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and categ_id = '%categ_id%' and audit_criteria_id = '%audit_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_audits set audit_score_id=dbo.uid_in('%audit_score_id%'), criteria_wf=%criteria_wf%, score_wf=dbo.wf_in('%score_wf%'), score=dbo.int32_in('%score%'), note=dbo.note_in('%note%'), user_id='%user_id%', fix_dt='%fix_dt%', photos=dbo.uids_in('%photos%')
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and categ_id = '%categ_id%' and audit_criteria_id = '%audit_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_audits (db_id, fix_date, account_id, categ_id, audit_criteria_id, audit_score_id, criteria_wf, score_wf, score, note, wf, sla, photos, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%categ_id%', '%audit_criteria_id%', dbo.uid_in('%audit_score_id%'), %criteria_wf%, dbo.wf_in('%score_wf%'), dbo.int32_in('%score%'), dbo.note_in('%note%'), %wf%, %sla%, dbo.uids_in('%photos%'), '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_audits>
<dyn_checkups templ="%fix_date%;%account_id%;%placement_id%;%prod_id%;%exist%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_checkups 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and placement_id = '%placement_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_checkups set exist=0%exist%, user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and placement_id = '%placement_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_checkups (db_id, fix_date, account_id, placement_id, prod_id, exist, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%placement_id%', '%prod_id%', 0%exist%, '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_checkups>
<dyn_oos templ="%fix_date%;%account_id%;%prod_id%;%oos_type_id%;%note%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_oos 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_oos set oos_type_id='%oos_type_id%', note=dbo.note_in('%note%'), user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_oos (db_id, fix_date, account_id, prod_id, oos_type_id, note, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%prod_id%', '%oos_type_id%', dbo.note_in('%note%'), '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_oos>
<dyn_presences templ="%fix_date%;%account_id%;%prod_id%;%facing%;%stock%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_presences 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_presences set facing=0%facing%, stock=0%stock%, user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_presences (db_id, fix_date, account_id, prod_id, facing, stock, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%prod_id%', 0%facing%, 0%stock%, '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_presences>
<dyn_prices templ="%fix_date%;%account_id%;%prod_id%;%price%;%promo%;%rrp%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_prices 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_prices set price=0%price%, promo=0%promo%, rrp=dbo.currency_in('%rrp%'), user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_prices (db_id, fix_date, account_id, prod_id, price, promo, rrp, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%prod_id%', 0%price%, 0%promo%, dbo.currency_in('%rrp%'), '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_prices>
<dyn_quests templ="%fix_date%;%account_id%;%qname_id%;%qrow_id%;%value%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_quests 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and qname_id = '%qname_id%' and qrow_id = '%qrow_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_quests set value='%value%', user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and qname_id = '%qname_id%' and qrow_id = '%qrow_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_quests (db_id, fix_date, account_id, qname_id, qrow_id, value, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%qname_id%', '%qrow_id%', '%value%', '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_quests>
<dyn_ratings templ="%fix_date%;%account_id%;%employee_id%;%rating_criteria_id%;%rating_score_id%;%criteria_wf%;%score_wf%;%score%;%note%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_ratings 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and employee_id = '%employee_id%' and rating_criteria_id = '%rating_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_ratings set rating_score_id=dbo.uid_in('%rating_score_id%'), criteria_wf=%criteria_wf%, score_wf=dbo.wf_in('%score_wf%'), score=dbo.int32_in('%score%'), note=dbo.note_in('%note%'), user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and employee_id = '%employee_id%' and rating_criteria_id = '%rating_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_ratings (db_id, fix_date, account_id, employee_id, rating_criteria_id, rating_score_id, criteria_wf, score_wf, score, note, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%employee_id%', '%rating_criteria_id%', dbo.uid_in('%rating_score_id%'), %criteria_wf%, dbo.wf_in('%score_wf%'), dbo.int32_in('%score%'), dbo.note_in('%note%'), '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_ratings>
<dyn_reviews templ="%fix_date%;%employee_id%;%sla%;%assessment%;%note0%;%note1%;%note2%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_reviews 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and employee_id = '%employee_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_reviews set sla=%sla%, assessment=%assessment%, note0=dbo.note_in('%note0%'), note1=dbo.note_in('%note1%'), note2=dbo.note_in('%note2%'), user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and employee_id = '%employee_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_reviews (db_id, fix_date, employee_id, sla, assessment, note0, note1, note2, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%employee_id%', %sla%, %assessment%, dbo.note_in('%note0%'), dbo.note_in('%note1%'), dbo.note_in('%note2%'), '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_reviews>
<dyn_shelfs templ="%fix_date%;%account_id%;%categ_id%;%brand_id%;%facing%;%assortment%;%sos%;%soa%;%photos%;%sos_target%;%soa_target%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_shelfs 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and categ_id = '%categ_id%' and brand_id = '%brand_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_shelfs set facing=dbo.int32_in('%facing%'), assortment=dbo.int32_in('%assortment%'), user_id='%user_id%', fix_dt='%fix_dt%', sos_target=dbo.wf_in('%sos_target%'), soa_target=dbo.wf_in('%soa_target%'), sos=case when '%sos%'='' then null else 0%sos% end, soa=case when '%soa%'='' then null else 0%soa% end, photos=dbo.uids_in('%photos%')
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and categ_id = '%categ_id%' and brand_id = '%brand_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_shelfs (db_id, fix_date, account_id, categ_id, brand_id, facing, assortment, fix_dt, user_id, sos_target, soa_target, sos, soa, photos)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%categ_id%', '%brand_id%', dbo.int32_in('%facing%'), dbo.int32_in('%assortment%'), '%fix_dt%', '%user_id%', dbo.wf_in('%sos_target%'), dbo.wf_in('%soa_target%'), case when '%sos%'='' then null else 0%sos% end, case when '%soa%'='' then null else 0%soa% end, dbo.uids_in('%photos%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_shelfs>
<dyn_stocks templ="%fix_date%;%account_id%;%prod_id%;%stock%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_stocks 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_stocks set stock=0%stock%, user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_stocks (db_id, fix_date, account_id, prod_id, stock, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%prod_id%', 0%stock%, '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_stocks>
<dyn_testings templ="%fix_date%;%account_id%;%contact_id%;%testing_criteria_id%;%testing_score_id%;%criteria_wf%;%score_wf%;%score%;%note%;%sla%;%fix_dt%;%user_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from dyn_testings 
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and contact_id = '%contact_id%' and testing_criteria_id = '%testing_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update dyn_testings set testing_score_id=dbo.uid_in('%testing_score_id%'), criteria_wf=%criteria_wf%, score_wf=dbo.wf_in('%score_wf%'), score=dbo.int32_in('%score%'), note=dbo.note_in('%note%'), sla=%sla%, user_id='%user_id%', fix_dt='%fix_dt%'
    where db_id = '%ErpCode%' and fix_date = '%fix_date%' and account_id = '%account_id%' and contact_id = '%contact_id%' and testing_criteria_id = '%testing_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into dyn_testings (db_id, fix_date, account_id, contact_id, testing_criteria_id, testing_score_id, criteria_wf, score_wf, score, note, sla, fix_dt, user_id)
    values ('%ErpCode%', '%fix_date%', '%account_id%', '%contact_id%', '%testing_criteria_id%', dbo.uid_in('%testing_score_id%'), %criteria_wf%, dbo.wf_in('%score_wf%'), dbo.int32_in('%score%'), dbo.note_in('%note%'), %sla%, '%fix_dt%', '%user_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</dyn_testings>
<equipment_types templ="%equipment_type_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update equipment_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from equipment_types 
    where db_id = '%ErpCode%' and equipment_type_id = '%equipment_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update equipment_types set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and equipment_type_id = '%equipment_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into equipment_types (db_id, equipment_type_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%equipment_type_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</equipment_types>
<equipments templ="%equipment_id%;%account_id%;%serial_number%;%equipment_type_id%;%ownership_type_id%;%extra_info%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update equipments set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from equipments 
    where db_id = '%ErpCode%' and equipment_id = '%equipment_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update equipments set account_id='%account_id%', serial_number='%serial_number%', equipment_type_id='%equipment_type_id%', ownership_type_id='%ownership_type_id%', extra_info='%extra_info%', hidden=0
    where db_id = '%ErpCode%' and equipment_id = '%equipment_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into equipments (db_id, equipment_id, account_id, serial_number, equipment_type_id, ownership_type_id, extra_info, hidden) 
    values ('%ErpCode%', '%equipment_id%', '%account_id%', '%serial_number%', '%equipment_type_id%', '%ownership_type_id%', '%extra_info%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostserial_number%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostserial_number%'
  ]]>
</end>
</equipments>
<job_titles templ="%job_title_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update job_titles set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from job_titles 
    where db_id = '%ErpCode%' and job_title_id = '%job_title_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update job_titles set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and job_title_id = '%job_title_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into job_titles (db_id, job_title_id, descr, hidden) 
    values ('%ErpCode%', '%job_title_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</job_titles>
<kinds templ="%kind_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update kinds set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from kinds 
    where db_id = '%ErpCode%' and kind_id = '%kind_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update kinds set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and kind_id = '%kind_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into kinds (db_id, kind_id, descr, row_no, hidden)
    values ('%ErpCode%', '%kind_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</kinds>
<manufacturers templ="%manuf_id%;%descr%;%competitor%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update manufacturers set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from manufacturers 
    where db_id = '%ErpCode%' and manuf_id = '%manuf_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update manufacturers set descr='%descr%', competitor=0%competitor%, hidden=0
    where db_id = '%ErpCode%' and manuf_id = '%manuf_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into manufacturers (db_id, manuf_id, descr, competitor, hidden) 
    values ('%ErpCode%', '%manuf_id%', '%descr%', 0%competitor%, 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</manufacturers>
<matrices templ="%account_id%;%prod_id%;%placement_ids%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from matrices
    where db_id = '%ErpCode%'
  ]]>
</begin>
<insert>
  <![CDATA[
insert into matrices (db_id, account_id, prod_id, placement_ids, row_no) 
    values ('%ErpCode%', '%account_id%', '%prod_id%', dbo.uids_in('%placement_ids%'), dbo.int32_in('%row_no%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</matrices>
<my_accounts templ="%user_id%;%account_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from my_accounts
    where db_id = '%ErpCode%'
  ]]>
</begin>
<insert>
  <![CDATA[
insert into my_accounts (db_id, user_id, account_id) 
    values ('%ErpCode%', '%user_id%', '%account_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</my_accounts>
<my_cities templ="%user_id%;%city_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from my_cities
    where db_id = '%ErpCode%'
  ]]>
</begin>
<insert>
  <![CDATA[
insert into my_cities (db_id, user_id, city_id) 
    values ('%ErpCode%', '%user_id%', '%city_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</my_cities>
<my_regions templ="%user_id%;%region_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from my_regions
    where db_id = '%ErpCode%'
  ]]>
</begin>
<insert>
  <![CDATA[
insert into my_regions (db_id, user_id, region_id) 
    values ('%ErpCode%', '%user_id%', '%region_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</my_regions>
<my_retail_chains templ="%user_id%;%rc_id%;%region_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from my_retail_chains
    where db_id = '%ErpCode%'
  ]]>
</begin>
<insert>
  <![CDATA[
insert into my_retail_chains (db_id, user_id, rc_id, region_id) 
    values ('%ErpCode%', '%user_id%', '%rc_id%', '%region_id%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</my_retail_chains>
<my_routes templ="%user_id%;%account_id%;%activity_type_id%;%p_date%;%row_no%;%duration%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
delete from my_routes
    where db_id = '%ErpCode%' and
p_date >= current_date::date_t
--p_date >= convert(varchar(10), getdate(), 121)
  ]]>
</begin>
<insert>
  <![CDATA[
insert into my_routes (db_id, user_id, account_id, activity_type_id, p_date, row_no, duration) 
    values ('%ErpCode%', '%user_id%', '%account_id%', '%activity_type_id%', '%p_date%', dbo.int32_in('%row_no%'), dbo.int32_in('%duration%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</my_routes>
<oos_types templ="%oos_type_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update oos_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from oos_types 
    where db_id = '%ErpCode%' and oos_type_id = '%oos_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update oos_types set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and oos_type_id = '%oos_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into oos_types (db_id, oos_type_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%oos_type_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</oos_types>
<orders templ="%doc_id%;%fix_dt%;%distr_id%;%user_id%;%account_id%;%order_type_id%;%group_price_id%;%wareh_id%;%delivery_date%;%delivery_type_id%;%delivery_note%;%doc_note%;%payment_method_id%;%payment_delay%;%bonus%;%encashment%;%order_param_ids%;%rows%;%prod_id%;%row_no%;%pack_id%;%pack%;%qty%;%unit_price%;%discount%;%amount%;%weight%;%volume%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from orders 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into orders (db_id, doc_id, fix_dt, user_id, account_id, distr_id, order_type_id, group_price_id, wareh_id, delivery_date, delivery_type_id, delivery_note, doc_note, payment_method_id, payment_delay, bonus, encashment, order_param_ids, rows, prod_id, row_no, pack_id, pack, qty, unit_price, discount, amount, weight, volume)
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%distr_id%', '%order_type_id%', '%group_price_id%', '%wareh_id%', '%delivery_date%', dbo.uid_in('%delivery_type_id%'), '%delivery_note%', '%doc_note%', '%payment_method_id%', dbo.int32_in('%payment_delay%'), dbo.currency_in('%bonus%'), dbo.currency_in('%encashment%'), dbo.uids_in('%order_param_ids%'), %rows%, '%prod_id%', %row_no%, '%pack_id%', %pack%, %qty%, %unit_price%, 0%discount%, %amount%, %weight%, %volume%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</orders>
<order_params templ="%distr_id%;%order_param_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update order_params set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from order_params
    where db_id = '%ErpCode%' and distr_id = '%distr_id%' and order_param_id = '%order_param_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update order_params set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and distr_id = '%distr_id%' and order_param_id = '%order_param_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into order_params (db_id, distr_id, order_param_id, descr)
    values ('%ErpCode%', '%distr_id%', '%order_param_id%', '%descr%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</order_params>
<order_types templ="%order_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update order_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from order_types 
    where db_id = '%ErpCode%' and order_type_id = '%order_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update order_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and order_type_id = '%order_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into order_types (db_id, order_type_id, descr, hidden) 
    values ('%ErpCode%', '%order_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</order_types>
<ownership_types templ="%ownership_type_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update ownership_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from ownership_types 
    where db_id = '%ErpCode%' and ownership_type_id = '%ownership_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update ownership_types set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and ownership_type_id = '%ownership_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into ownership_types (db_id, ownership_type_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%ownership_type_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</ownership_types>
<packs templ="%pack_id%;%prod_id%;%descr%;%pack%;%weight%;%volume%;%precision%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update packs set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from packs 
    where db_id = '%ErpCode%' and pack_id = '%pack_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update packs set descr='%descr%', pack=%pack%, weight=0%weight%, volume=0%volume%, "precision"=0%precision%, hidden=0
    where db_id = '%ErpCode%' and pack_id = '%pack_id%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into packs (db_id, pack_id, prod_id, descr, pack, weight, volume, "precision", hidden) 
    values ('%ErpCode%', '%pack_id%', '%prod_id%', '%descr%', 0%pack%, 0%weight%, 0%volume%, 0%precision%, 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</packs>
<payment_methods templ="%payment_method_id%;%descr%;%encashment%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update payment_methods set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from payment_methods 
    where db_id = '%ErpCode%' and payment_method_id = '%payment_method_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update payment_methods set descr='%descr%', encashment=dbo.bool_in('%encashment%'), row_no=dbo.int32_in('%row_no%'), hidden=0 
    where db_id = '%ErpCode%' and payment_method_id = '%payment_method_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into payment_methods (db_id, payment_method_id, descr, encashment, row_no, hidden) 
    values ('%ErpCode%', '%payment_method_id%', '%descr%', dbo.bool_in('%encashment%'), dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</payment_methods>
<pending_types templ="%pending_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update pending_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from pending_types 
    where db_id = '%ErpCode%' and pending_type_id = '%pending_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update pending_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and pending_type_id = '%pending_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into pending_types (db_id, pending_type_id, descr, hidden) 
    values ('%ErpCode%', '%pending_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</pending_types>
<photos templ="%doc_id%;%fix_dt%;%user_id%;%account_id%;%placement_id%;%brand_id%;%photo_type_id%;%photo%;%doc_note%;%photo_param_ids%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from photos 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into photos (db_id, doc_id, fix_dt, user_id, account_id, placement_id, brand_id, photo_type_id, photo, doc_note, photo_param_ids) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%placement_id%', '%brand_id%', '%photo_type_id%', dbo.uid_in('%photo%'), dbo.note_in('%doc_note%'), dbo.uids_in('%photo_param_ids%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</photos>
<photo_params templ="%photo_param_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update photo_params set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from photo_params 
    where db_id = '%ErpCode%' and photo_param_id = '%photo_param_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update photo_params set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and photo_param_id = '%photo_param_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into photo_params (db_id, photo_param_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%photo_param_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</photo_params>
<photo_types templ="%photo_type_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update photo_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from photo_types 
    where db_id = '%ErpCode%' and photo_type_id = '%photo_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update photo_types set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and photo_type_id = '%photo_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into photo_types (db_id, photo_type_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%photo_type_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</photo_types>
<placements templ="%placement_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update placements set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from placements 
    where db_id = '%ErpCode%' and placement_id = '%placement_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update placements set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0 
    where db_id = '%ErpCode%' and placement_id = '%placement_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into placements (db_id, placement_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%placement_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</placements>
<pos_materials templ="%posm_id%;%descr%;%brand_ids%;%placement_ids%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update pos_materials set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from pos_materials 
    where db_id = '%ErpCode%' and posm_id = '%posm_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update pos_materials set descr='%descr%', brand_ids=dbo.uids_in('%brand_ids%'), placement_ids=dbo.uids_in('%placement_ids%'), hidden=0 
    where db_id = '%ErpCode%' and posm_id = '%posm_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into pos_materials (db_id, posm_id, descr, brand_ids, placement_ids, hidden) 
    values ('%ErpCode%', '%posm_id%', '%descr%', dbo.uids_in('%brand_ids%'), dbo.uids_in('%placement_ids%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</pos_materials>
<potentials templ="%poten_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update potentials set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from potentials 
    where db_id = '%ErpCode%' and poten_id = '%poten_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update potentials set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and poten_id = '%poten_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into potentials (db_id, poten_id, descr, hidden) 
    values ('%ErpCode%', '%poten_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</potentials>
<products templ="%prod_id%;%pid%;%ftype%;%code%;%descr%;%kind_id%;%brand_id%;%categ_id%;%shelf_life_id%;%art%;%obsolete%;%novelty%;%promo%;%barcodes%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update products set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from products 
    where db_id = '%ErpCode%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update products set pid=dbo.uid_in('%pid%'), ftype=0%ftype%, code='%code%', art='%art%', descr='%descr%', shelf_life_id=dbo.uid_in('%shelf_life_id%'), kind_id=dbo.uid_in('%kind_id%'), brand_id=dbo.uid_in('%brand_id%'), categ_id=dbo.uid_in('%categ_id%'), obsolete=0%obsolete%, novelty=0%novelty%, promo=0%promo%, barcodes=dbo.ean13ar_in('%barcodes%'), hidden=0
    where db_id = '%ErpCode%' and prod_id = '%prod_id%'
  ]]>
</update>
<insert>
  <![CDATA[ 
insert into products (db_id, pid, prod_id, ftype, code, art, descr, kind_id, shelf_life_id, brand_id, categ_id, obsolete, novelty, promo, barcodes, hidden)
    values ('%ErpCode%', dbo.uid_in('%pid%'), '%prod_id%', %ftype%, '%code%', '%art%', '%descr%', dbo.uid_in('%kind_id%'), dbo.uid_in('%shelf_life_id%'), dbo.uid_in('%brand_id%'), dbo.uid_in('%categ_id%'), 0%obsolete%, 0%novelty%, 0%promo%, dbo.ean13ar_in('%barcodes%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</products>
<presentations templ="%doc_id%;%fix_dt%;%user_id%;%account_id%;%participants%;%tm_ids%;%doc_note%;%photo%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from presentations 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into presentations (db_id, doc_id, fix_dt, user_id, account_id, participants, tm_ids, doc_note, photo) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', %participants%, dbo.uids_in('%tm_ids%'), dbo.note_in('%doc_note%'), dbo.uid_in('%photo%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</presentations>
<quest_names templ="%qname_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update quest_names set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from quest_names 
    where db_id = '%ErpCode%' and qname_id = '%qname_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update quest_names set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and qname_id = '%qname_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into quest_names (db_id, qname_id, descr, hidden) 
    values ('%ErpCode%', '%qname_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</quest_names>
<quest_rows templ="%qname_id%;%qrow_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update quest_rows set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from quest_rows 
    where db_id = '%ErpCode%' and qname_id='%qname_id%' and qrow_id = '%qrow_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update quest_rows set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and qname_id='%qname_id%' and qrow_id = '%qrow_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into quest_rows (db_id, qname_id, qrow_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%qname_id%', '%qrow_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</quest_rows>
<rating_criterias templ="%rating_criteria_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update rating_criterias set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from rating_criterias 
    where db_id = '%ErpCode%' and rating_criteria_id = '%rating_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update rating_criterias set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and rating_criteria_id = '%rating_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into rating_criterias (db_id, rating_criteria_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%rating_criteria_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</rating_criterias>
<rating_scores templ="%rating_score_id%;%descr%;%score%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update rating_scores set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from rating_scores 
    where db_id = '%ErpCode%' and rating_score_id = '%rating_score_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update rating_scores set descr='%descr%', score=%score%, row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and rating_score_id = '%rating_score_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into rating_scores (db_id, rating_score_id, descr, score, row_no, hidden) 
    values ('%ErpCode%', '%rating_score_id%', '%descr%', %score%, dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</rating_scores>
<receipts templ="%doc_id%;%fix_dt%;%distr_id%;%user_id%;%account_id%;%receipt_type_id%;%amount%;%doc_note%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from receipts 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into receipts (db_id, doc_id, fix_dt, distr_id, user_id, account_id, receipt_type_id, doc_note, amount) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%distr_id%', '%user_id%', '%account_id%', '%receipt_type_id%', '%doc_note%', '%amount%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</receipts>
<receipt_types templ="%receipt_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update receipt_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from receipt_types 
    where db_id = '%ErpCode%' and receipt_type_id = '%receipt_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update receipt_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and receipt_type_id = '%receipt_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into receipt_types (db_id, receipt_type_id, descr, hidden) 
    values ('%ErpCode%', '%receipt_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</receipt_types>
<reclamations templ="%doc_id%;%fix_dt%;%distr_id%;%user_id%;%account_id%;%return_date%;%doc_note%;%rows%;%prod_id%;%row_no%;%reclamation_type_id%;%pack_id%;%pack%;%qty%;%unit_price%;%amount%;%weight%;%volume%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from reclamations 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%' and prod_id = '%prod_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into reclamations (db_id, doc_id, fix_dt, user_id, account_id, distr_id, return_date, doc_note, rows, prod_id, row_no, reclamation_type_id, pack_id, pack, qty, unit_price, amount, weight, volume) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%distr_id%', '%return_date%', '%doc_note%', %rows%, '%prod_id%', %row_no%, '%reclamation_type_id%', '%pack_id%', %pack%, %qty%, %unit_price%, %amount%, %weight%, %volume%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</reclamations>
<reclamation_types templ="%reclamation_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update reclamation_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from reclamation_types 
    where db_id = '%ErpCode%' and reclamation_type_id = '%reclamation_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update reclamation_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and reclamation_type_id = '%reclamation_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into reclamation_types (db_id, reclamation_type_id, descr, hidden) 
    values ('%ErpCode%', '%reclamation_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</reclamation_types>
<regions templ="%region_id%;%descr%;%country_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update regions set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from regions 
    where db_id = '%ErpCode%' and region_id = '%region_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update regions set descr='%descr%', country_id='%country_id%', hidden=0
    where db_id = '%ErpCode%' and region_id = '%region_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into regions (db_id, region_id, descr, country_id, hidden) 
    values ('%ErpCode%', '%region_id%', '%descr%', '%country_id%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</regions>
<retail_chains templ="%rc_id%;%pid%;%descr%;%ka_code%;%country_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update retail_chains set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from retail_chains 
    where db_id = '%ErpCode%' and rc_id = '%rc_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update retail_chains set descr='%descr%', ka_code='%ka_code%', pid='%pid%', country_id='%country_id%', hidden=0
    where db_id = '%ErpCode%' and rc_id = '%rc_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into retail_chains (db_id, rc_id, descr, ka_code, pid, country_id, hidden) 
    values ('%ErpCode%', '%rc_id%', '%descr%', '%ka_code%', '%pid%', '%country_id%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
update retail_chains set pid=null where pid='' and hidden=0;
update retail_chains set country_id=null where country_id='' and hidden=0;
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</retail_chains>
<revocations templ="%doc_id%;%doc_type%;%hidden%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from revocations 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update revocations set hidden=0%hidden%
    where db_id = '%ErpCode%' and user_id = '%doc_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into revocations (db_id, doc_id, doc_type, hidden) 
    values ('%ErpCode%', '%doc_id%', '%doc_type%', 0%hidden%)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</revocations>
<shelf_lifes templ="%shelf_life_id%;%descr%;%days%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update shelf_lifes set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from shelf_lifes 
    where db_id = '%ErpCode%' and shelf_life_id = '%shelf_life_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update shelf_lifes set descr='%descr%', days=dbo.int32_in('%days%'), hidden=0
    where db_id = '%ErpCode%' and shelf_life_id = '%shelf_life_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into shelf_lifes (db_id, shelf_life_id, descr, days, hidden) 
    values ('%ErpCode%', '%shelf_life_id%', '%descr%', dbo.int32_in('%days%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</shelf_lifes>
<target_types templ="%target_type_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update target_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from target_types 
    where db_id = '%ErpCode%' and target_type_id = '%target_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update target_types set descr='%descr%', hidden=0 
    where db_id = '%ErpCode%' and target_type_id = '%target_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into target_types (db_id, target_type_id, descr, hidden) 
    values ('%ErpCode%', '%target_type_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</target_types>
<targets templ="%target_id%;%target_type_id%;%subject%;%body%;%b_date%;%e_date%;%image%;%author_id%;%myself%;%hidden%;%attrs%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from targets 
    where db_id = '%ErpCode%' and target_id = '%target_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update targets set target_type_id='%target_type_id%', subject='%subject%', body='%body%', b_date='%b_date%', e_date='%e_date%', image=dbo.uid_in('%image%'), author_id='%author_id%', myself='%myself%', hidden=0%hidden%, attrs='%attrs%'
    where db_id = '%ErpCode%' and target_id = '%target_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into targets (db_id, target_id, target_type_id, subject, body, b_date, e_date, image, author_id, myself, hidden, attrs) 
    values ('%ErpCode%', '%target_id%', '%target_type_id%', '%subject%', '%body%', '%b_date%', '%e_date%', dbo.uid_in('%image%'), '%author_id%', '%myself%', 0%hidden%, '%attrs%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</targets>
<testing_criterias templ="%testing_criteria_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update testing_criterias set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from testing_criterias 
    where db_id = '%ErpCode%' and testing_criteria_id = '%testing_criteria_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update testing_criterias set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and testing_criteria_id = '%testing_criteria_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into testing_criterias (db_id, testing_criteria_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%testing_criteria_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</testing_criterias>
<testing_scores templ="%testing_score_id%;%descr%;%score%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update testing_scores set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from testing_scores 
    where db_id = '%ErpCode%' and testing_score_id = '%testing_score_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update testing_scores set descr='%descr%', score=%score%, row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and testing_score_id = '%testing_score_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into testing_scores (db_id, testing_score_id, descr, score, row_no, hidden) 
    values ('%ErpCode%', '%testing_score_id%', '%descr%', %score%, dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</testing_scores>
<thumbnails templ="%ref_id%;%photo%;%thumb%;%thumb_width%;%thumb_height%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from thumbnails 
    where db_id = '%ErpCode%' and ref_id = '%ref_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update thumbnails set thumb = dbo.resolve_blob_stream('//proxy/%uid%/%thumb%'), thumb_width = dbo.int32_in('%thumb_width%'), thumb_height = dbo.int32_in('%thumb_height%')
    where db_id = '%ErpCode%' and ref_id = '%ref_id%' and thumb is null
  ]]>
</update>
<insert>
  <![CDATA[
insert into thumbnails (db_id, ref_id, photo, thumb, thumb_width, thumb_height) 
    values ('%ErpCode%', '%ref_id%', dbo.resolve_blob_stream('//proxy/%uid%/%photo%'), dbo.resolve_blob_stream('//proxy/%uid%/%thumb%'), dbo.int32_in('%thumb_width%'), dbo.int32_in('%thumb_height%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</thumbnails>
<training_materials templ="%tm_id%;%descr%;%brand_ids%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update training_materials set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from training_materials 
    where db_id = '%ErpCode%' and tm_id = '%tm_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update training_materials set descr='%descr%', brand_ids=dbo.uids_in('%brand_ids%'), hidden=0 
    where db_id = '%ErpCode%' and tm_id = '%tm_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into training_materials (db_id, tm_id, descr, brand_ids, hidden) 
    values ('%ErpCode%', '%tm_id%', '%descr%', dbo.uids_in('%brand_ids%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</training_materials>
<training_types templ="%training_type_id%;%descr%;%personal%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update training_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from training_types 
    where db_id = '%ErpCode%' and training_type_id = '%training_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update training_types set descr='%descr%', personal=%personal%, row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and training_type_id = '%training_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into training_types (db_id, training_type_id, descr, personal, row_no, hidden) 
    values ('%ErpCode%', '%training_type_id%', '%descr%', %personal%, dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</training_types>
<trainings templ="%doc_id%;%fix_dt%;%user_id%;%account_id%;%training_type_id%;%contact_ids%;%tm_ids%;%doc_note%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from trainings 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into trainings (db_id, doc_id, fix_dt, user_id, account_id, training_type_id, contact_ids, tm_ids, doc_note) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%account_id%', '%training_type_id%', dbo.uids_in('%contact_ids%'), dbo.uids_in('%tm_ids%'), dbo.note_in('%doc_note%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</trainings>
<unsched templ="%doc_id%;%fix_dt%;%user_id%;%unsched_type_id%;%doc_note%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from unsched 
    where db_id = '%ErpCode%' and doc_id = '%doc_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into unsched (db_id, doc_id, fix_dt, user_id, unsched_type_id, doc_note) 
    values ('%ErpCode%', '%doc_id%', '%fix_dt%', '%user_id%', '%unsched_type_id%', '%doc_note%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</unsched>
<unsched_types templ="%unsched_type_id%;%descr%;%row_no%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update unsched_types set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from unsched_types 
    where db_id = '%ErpCode%' and unsched_type_id = '%unsched_type_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update unsched_types set descr='%descr%', row_no=dbo.int32_in('%row_no%'), hidden=0
    where db_id = '%ErpCode%' and unsched_type_id = '%unsched_type_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into unsched_types (db_id, unsched_type_id, descr, row_no, hidden) 
    values ('%ErpCode%', '%unsched_type_id%', '%descr%', dbo.int32_in('%row_no%'), 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</unsched_types>
<user_activities templ="%user_id%;%account_id%;%w_cookie%;%a_cookie%;%activity_type_id%;%fix_date%;%route_date%;%b_dt%;%b_la%;%b_lo%;%b_sat_dt%;%e_dt%;%e_la%;%e_lo%;%e_sat_dt%;%employee_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from user_activities 
    where db_id = '%ErpCode%' and user_id = '%user_id%' and account_id = '%account_id%' and activity_type_id = '%activity_type_id%' and w_cookie = '%w_cookie%' and a_cookie = '%a_cookie%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update user_activities set e_dt=dbo.datetime_in('%e_dt%'), e_la=dbo.gps_in('%e_la%'), e_lo=dbo.gps_in('%e_lo%'), e_sat_dt=dbo.datetime_in('%e_sat_dt%'), employee_id=dbo.uid_in('%employee_id%'
    where db_id = '%ErpCode%' and user_id = '%user_id%' and account_id = '%account_id%' and activity_type_id = '%activity_type_id%' and w_cookie = '%w_cookie%' and a_cookie = '%a_cookie%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into user_activities (db_id, user_id, account_id, w_cookie, a_cookie, activity_type_id, fix_date, route_date, b_dt, b_la, b_lo, b_sat_dt, e_dt, e_la, e_lo, e_sat_dt, employee_id) 
    values ('%ErpCode%', '%user_id%', '%account_id%', '%w_cookie%', '%a_cookie%', '%activity_type_id%', '%fix_date%', '%route_date%', '%b_dt%', dbo.gps_in('%b_la%'), dbo.gps_in('%b_lo%'), dbo.datetime_in('%b_sat_dt%'), dbo.datetime_in('%e_dt%'), dbo.gps_in('%e_la%'), dbo.gps_in('%e_lo%'), dbo.datetime_in('%e_sat_dt%'), dbo.uid_in('%employee_id%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</user_activities>
<user_documents templ="%act_id%;%user_id%;%w_cookie%;%fix_date%;%doc_type%;%doc_id%;%doc_no%;%duration%;%rows%;%fix_dt%;%latitude%;%longitude%;%satellite_dt%;%a_cookie%;%account_id%;%activity_type_id%;%employee_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from user_documents 
    where db_id = '%ErpCode%' and act_id = '%act_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into user_documents (db_id, act_id, user_id, w_cookie, fix_date, doc_type, doc_id, doc_no, duration, rows, fix_dt, latitude, longitude, satellite_dt, a_cookie, account_id, activity_type_id, employee_id) 
    values ('%ErpCode%', '%act_id%', '%user_id%', '%w_cookie%', '%fix_date%', '%doc_type%', '%doc_id%', '%doc_no%', %duration%, 0%rows%, '%fix_dt%', '%latitude%', '%longitude%', '%satellite_dt%', '%a_cookie%', '%account_id%', '%activity_type_id%', dbo.uid_in('%employee_id%'))
  ]]>
</insert>
<update>
  <![CDATA[
update user_documents set doc_id='%doc_id%'
    where db_id = '%ErpCode%' and act_id = '%act_id%'
  ]]>
</update>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</user_documents>
<user_locations templ="%act_id%;%row_no%;%user_id%;%fix_date%;%latitude%;%longitude%;%fix_dt%;%satellite_dt%;%accuracy%;%altitude%;%bearing%;%speed%;%seconds%;%provider%;%satellites%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from user_locations 
    where db_id = '%ErpCode%' and act_id = '%act_id%' and row_no = %row_no%
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into user_locations (db_id, act_id, row_no, user_id, fix_date, latitude, longitude, fix_dt, satellite_dt, accuracy, altitude, bearing, speed, seconds, provider, satellites) 
    values ('%ErpCode%', '%act_id%', %row_no%, '%user_id%', '%fix_date%', %latitude%, %longitude%, '%fix_dt%', '%satellite_dt%', %accuracy%, %altitude%, %bearing%, %speed%, dbo.int32_in('%seconds%'), '%provider%', '%satellites%')
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</user_locations>
<user_reports templ="%act_id%;%user_id%;%w_cookie%;%fix_date%;%doc_type%;%duration%;%fix_dt%;%latitude%;%longitude%;%satellite_dt%;%a_cookie%;%account_id%;%activity_type_id%;%employee_id%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from user_reports 
    where db_id = '%ErpCode%' and act_id = '%act_id%'
  ]]>
</check_exist>
<insert>
  <![CDATA[
insert into user_reports (db_id, act_id, user_id, w_cookie, fix_date, doc_type, duration, fix_dt, latitude, longitude, satellite_dt, a_cookie, account_id, activity_type_id, employee_id) 
    values ('%ErpCode%', '%act_id%', '%user_id%', '%w_cookie%', '%fix_date%', '%doc_type%', '%duration%', '%fix_dt%', '%latitude%', '%longitude%', '%satellite_dt%', '%a_cookie%', '%account_id%', '%activity_type_id%', dbo.uid_in('%employee_id%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</user_reports>
<users templ="%user_id%;%pids%;%descr%;%role%;%country_ids%;%dep_ids%;%distr_ids%;%agency_id%;%mobile%;%email%;%area%;%rules:wd_begin%;%rules:wd_end%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update users set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from users 
    where db_id = '%ErpCode%' and user_id = '%user_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update users set pids=dbo.uids_in('%pids%'), descr='%descr%', role='%role%', dep_ids=dbo.uids_in('%dep_ids%'), country_ids=dbo.uids_in('%country_ids%'), distr_ids=dbo.uids_in('%distr_ids%'), agency_id=dbo.uid_in('%agency_id%'), mobile='%mobile%', email='%email%', "rules:wd_begin"='%rules:wd_begin%', "rules:wd_end"='%rules:wd_end%', hidden=0
    where db_id = '%ErpCode%' and user_id = '%user_id%'
  ]]>
</update>
<insert>
  <![CDATA[ 
insert into users (db_id, user_id, pids, descr, role, dep_ids, country_ids, distr_ids, agency_id, mobile, email, area, "rules:wd_begin", "rules:wd_end", hidden)
    values ('%ErpCode%', '%user_id%', dbo.uids_in('%pids%'), '%descr%', '%role%', dbo.uids_in('%dep_ids%'), dbo.uids_in('%country_ids%'), dbo.uids_in('%distr_ids%'), dbo.uid_in('%agency_id%'), '%mobile%', '%email%', '%area%', '%rules:wd_begin%', '%rules:wd_end%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</users>
<user_works templ="%user_id%;%w_cookie%;%fix_date%;%b_dt%;%b_la%;%b_lo%;%b_sat_dt%;%e_dt%;%e_la%;%e_lo%;%e_sat_dt%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<check_exist>
  <![CDATA[
select count(*) exist from user_works 
    where db_id = '%ErpCode%' and user_id = '%user_id%' and w_cookie = '%w_cookie%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update user_works set e_dt=dbo.datetime_in('%e_dt%'), e_la=dbo.gps_in('%e_la%'), e_lo=dbo.gps_in('%e_lo%'), e_sat_dt=dbo.datetime_in('%e_sat_dt%')
    where db_id = '%ErpCode%' and user_id = '%user_id%' and w_cookie = '%w_cookie%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into user_works (db_id, user_id, w_cookie, fix_date, b_dt, b_la, b_lo, b_sat_dt, e_dt, e_la, e_lo, e_sat_dt) 
    values ('%ErpCode%', '%user_id%', '%w_cookie%', '%fix_date%', '%b_dt%', dbo.gps_in('%b_la%'), dbo.gps_in('%b_lo%'), dbo.datetime_in('%b_sat_dt%'), dbo.datetime_in('%e_dt%'), dbo.gps_in('%e_la%'), dbo.gps_in('%e_lo%'), dbo.datetime_in('%e_sat_dt%'))
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</user_works>
<warehouses templ="%distr_id%;%wareh_id%;%descr%;">
<verification>
  <![CDATA[
select count(*) from data_stream
    where s_id = '//proxy/%uid%/%pack_code%' and digest = '%pack_digest%'
  ]]>
</verification>
<begin>
  <![CDATA[
update warehouses set hidden=1
    where db_id = '%ErpCode%' and hidden = 0
  ]]>
</begin>
<check_exist>
  <![CDATA[
select count(*) exist from warehouses 
    where db_id = '%ErpCode%' and distr_id = '%distr_id%' and wareh_id = '%wareh_id%'
  ]]>
</check_exist>
<update>
  <![CDATA[
update warehouses set descr='%descr%', hidden=0
    where db_id = '%ErpCode%' and distr_id = '%distr_id%' and wareh_id = '%wareh_id%'
  ]]>
</update>
<insert>
  <![CDATA[
insert into warehouses (db_id, distr_id, wareh_id, descr, hidden) 
    values ('%ErpCode%', '%distr_id%', '%wareh_id%', '%descr%', 0)
  ]]>
</insert>
<end>
  <![CDATA[
--select stor_data_stream('//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%')
exec stor_data_stream '//proxy/%uid%/%pack_code%', '%pack_digest%', '%server_hostname%'
  ]]>
</end>
</warehouses>
<!--<xi:include href="../queries/data/trig_after.xconf" xmlns:xi="http://www.w3.org/2003/XInclude" />-->
</kernel>
</omobusd>
